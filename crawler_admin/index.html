<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…±äº«CFO - çˆ¬è™«æ§åˆ¶å°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Orbitron:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a25;
            --border-color: #2a2a3a;
            --text-primary: #e0e0e0;
            --text-secondary: #888899;
            --accent-green: #00ff88;
            --accent-orange: #ff6b35;
            --accent-blue: #00d4ff;
            --accent-red: #ff3366;
            --glow-green: 0 0 20px rgba(0, 255, 136, 0.3);
            --glow-orange: 0 0 20px rgba(255, 107, 53, 0.3);
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Scanline effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.1) 0px,
                rgba(0, 0, 0, 0.1) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            z-index: 1000;
            opacity: 0.3;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 30px;
        }

        .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 24px;
            font-weight: 900;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            border: 2px solid var(--accent-green);
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }

        .logo-icon::before {
            content: '';
            width: 12px;
            height: 12px;
            background: var(--accent-green);
            box-shadow: var(--glow-green);
        }

        .status-bar {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: blink 1.5s infinite;
        }

        .status-indicator.online { background: var(--accent-green); box-shadow: var(--glow-green); }
        .status-indicator.offline { background: var(--accent-red); }
        .status-indicator.warning { background: var(--accent-orange); box-shadow: var(--glow-orange); }

        /* Main Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            gap: 20px;
            margin-bottom: 30px;
        }

        /* Panel Base */
        .panel {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-green), var(--accent-blue));
        }

        .panel-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--accent-green);
        }

        .panel-body {
            padding: 20px;
        }

        /* Control Panel */
        .control-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
        }

        .btn {
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            padding: 12px 20px;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            border-color: var(--accent-green);
            box-shadow: var(--glow-green);
        }

        .btn-primary {
            background: var(--accent-green);
            color: var(--bg-primary);
            border-color: var(--accent-green);
            font-weight: 700;
        }

        .btn-primary:hover {
            background: #00ff99;
        }

        .btn-warning {
            border-color: var(--accent-orange);
            color: var(--accent-orange);
        }

        .btn-warning:hover {
            background: var(--accent-orange);
            color: var(--bg-primary);
        }

        .btn-danger {
            border-color: var(--accent-red);
            color: var(--accent-red);
        }

        .btn-danger:hover {
            background: var(--accent-red);
            color: var(--bg-primary);
        }

        /* Phase Selectors */
        .phase-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .phase-btn {
            font-size: 11px;
            padding: 10px;
            text-align: center;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .phase-btn:hover, .phase-btn.active {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.2);
        }

        /* Stats Display */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .stat-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .stat-card::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--accent-green);
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .stat-card:hover::after {
            transform: scaleX(1);
        }

        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 36px;
            font-weight: 900;
            color: var(--accent-green);
            line-height: 1;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
        }

        .stat-change {
            font-size: 10px;
            margin-top: 8px;
        }

        .stat-change.positive { color: var(--accent-green); }
        .stat-change.negative { color: var(--accent-red); }

        /* Chart Area */
        .chart-container {
            height: 250px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            padding: 20px;
            position: relative;
        }

        .chart-bars {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            height: 180px;
            gap: 8px;
        }

        .chart-bar {
            flex: 1;
            background: linear-gradient(180deg, var(--accent-green), var(--accent-blue));
            opacity: 0.7;
            transition: all 0.3s;
            position: relative;
            min-height: 20%;
        }

        .chart-bar:hover {
            opacity: 1;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        }

        .chart-bar::before {
            content: attr(data-value);
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            color: var(--accent-green);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .chart-bar:hover::before {
            opacity: 1;
        }

        .chart-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 10px;
            color: var(--text-secondary);
        }

        /* Log Panel */
        .log-panel {
            height: 400px;
            display: flex;
            flex-direction: column;
        }

        .log-content {
            flex: 1;
            overflow-y: auto;
            font-size: 12px;
            line-height: 1.6;
            padding: 15px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
        }

        .log-entry {
            margin-bottom: 8px;
            display: flex;
            gap: 10px;
            opacity: 0;
            animation: fadeIn 0.3s forwards;
        }

        .log-time {
            color: var(--text-secondary);
            flex-shrink: 0;
        }

        .log-message {
            flex: 1;
        }

        .log-entry.info .log-message { color: var(--text-primary); }
        .log-entry.success .log-message { color: var(--accent-green); }
        .log-entry.warning .log-message { color: var(--accent-orange); }
        .log-entry.error .log-message { color: var(--accent-red); }

        .log-content::-webkit-scrollbar {
            width: 6px;
        }

        .log-content::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        .log-content::-webkit-scrollbar-thumb {
            background: var(--border-color);
        }

        /* Activity Feed */
        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .activity-item {
            display: flex;
            gap: 15px;
            padding: 12px;
            background: var(--bg-tertiary);
            border-left: 3px solid var(--border-color);
            transition: all 0.2s;
        }

        .activity-item:hover {
            border-left-color: var(--accent-green);
            transform: translateX(5px);
        }

        .activity-icon {
            width: 32px;
            height: 32px;
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 14px;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-size: 12px;
            margin-bottom: 4px;
        }

        .activity-time {
            font-size: 10px;
            color: var(--text-secondary);
        }

        /* Progress Ring */
        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            position: relative;
        }

        .progress-ring svg {
            transform: rotate(-90deg);
        }

        .progress-ring-bg {
            fill: none;
            stroke: var(--border-color);
            stroke-width: 8;
        }

        .progress-ring-bar {
            fill: none;
            stroke: var(--accent-green);
            stroke-width: 8;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s;
        }

        .progress-ring-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .progress-ring-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 28px;
            font-weight: 900;
            color: var(--accent-green);
        }

        .progress-ring-label {
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { box-shadow: var(--glow-green); }
            50% { box-shadow: 0 0 30px rgba(0, 255, 136, 0.6); }
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Loading State */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-top-color: var(--accent-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 1px solid;
        }

        .badge-success {
            border-color: var(--accent-green);
            color: var(--accent-green);
        }

        .badge-warning {
            border-color: var(--accent-orange);
            color: var(--accent-orange);
        }

        .badge-error {
            border-color: var(--accent-red);
            color: var(--accent-red);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon"></div>
                <span>SHARED_CFO</span>
                <span style="color: var(--text-secondary); font-weight: 400; font-size: 14px;">// CRAWLER ADMIN</span>
            </div>
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-indicator online" id="serverStatus"></div>
                    <span id="serverStatusText">æœåŠ¡å™¨åœ¨çº¿</span>
                </div>
                <div class="status-item">
                    <div class="status-indicator warning" id="crawlerStatus"></div>
                    <span id="crawlerStatusText">çˆ¬è™«å¾…æœº</span>
                </div>
                <div class="status-item">
                    <span style="color: var(--accent-green);">â—</span>
                    <span id="lastUpdate">åˆšåˆšæ›´æ–°</span>
                </div>
            </div>
        </header>

        <!-- Main Dashboard -->
        <div class="dashboard-grid">
            <!-- Left Panel: Controls -->
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title">æ§åˆ¶ä¸­å¿ƒ</span>
                    <span class="badge badge-success">READY</span>
                </div>
                <div class="panel-body">
                    <div class="control-panel">
                        <!-- Crawler Status -->
                        <div class="control-group">
                            <div class="progress-ring">
                                <svg width="120" height="120">
                                    <circle class="progress-ring-bg" cx="60" cy="60" r="52"></circle>
                                    <circle class="progress-ring-bar" cx="60" cy="60" r="52"
                                        stroke-dasharray="326.73"
                                        stroke-dashoffset="326.73"
                                        id="progressRing"></circle>
                                </svg>
                                <div class="progress-ring-text">
                                    <div class="progress-ring-value" id="progressValue">0%</div>
                                    <div class="progress-ring-label">è¿›åº¦</div>
                                </div>
                            </div>
                        </div>

                        <!-- Crawl Phase -->
                        <div class="control-group">
                            <label class="control-label">çˆ¬å–é˜¶æ®µ</label>
                            <div class="phase-grid">
                                <div class="phase-btn active" data-phase="test">æµ‹è¯•</div>
                                <div class="phase-btn" data-phase="week1">ç¬¬1å‘¨</div>
                                <div class="phase-btn" data-phase="week2">ç¬¬2å‘¨</div>
                                <div class="phase-btn" data-phase="week3">ç¬¬3å‘¨</div>
                                <div class="phase-btn" data-phase="complete">å®Œæ•´</div>
                                <div class="phase-btn" data-phase="custom">è‡ªå®šä¹‰</div>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="control-group">
                            <label class="control-label">æ“ä½œ</label>
                            <button class="btn btn-primary" id="startCrawl">
                                <span style="margin-right: 8px;">â–¶</span>å¯åŠ¨çˆ¬è™«
                            </button>
                            <button class="btn btn-warning" id="pauseCrawl" disabled>
                                <span style="margin-right: 8px;">â¸</span>æš‚åœçˆ¬è™«
                            </button>
                            <button class="btn btn-danger" id="stopCrawl" disabled>
                                <span style="margin-right: 8px;">â¹</span>åœæ­¢çˆ¬è™«
                            </button>
                        </div>

                        <!-- Quick Actions -->
                        <div class="control-group">
                            <label class="control-label">å¿«é€Ÿæ“ä½œ</label>
                            <button class="btn" id="buildRelationships">
                                <span style="margin-right: 8px;">ğŸ”—</span>æ„å»ºå…³è”å…³ç³»
                            </button>
                            <button class="btn" id="validateData">
                                <span style="margin-right: 8px;">âœ“</span>éªŒè¯æ•°æ®è´¨é‡
                            </button>
                            <button class="btn" id="exportData">
                                <span style="margin-right: 8px;">ğŸ“¥</span>å¯¼å‡ºæ•°æ®
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Center Panel: Stats & Charts -->
            <div style="display: flex; flex-direction: column; gap: 20px;">
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalPolicies">71</div>
                        <div class="stat-label">æ€»æ”¿ç­–æ•°</div>
                        <div class="stat-change positive">â†‘ æœ¬å‘¨ +12</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="l1Count">7</div>
                        <div class="stat-label">L1 æ³•å¾‹</div>
                        <div class="stat-change">å æ¯” 9.9%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="l2Count">4</div>
                        <div class="stat-label">L2 æ³•è§„</div>
                        <div class="stat-change">å æ¯” 5.6%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="crawlRate">2.3</div>
                        <div class="stat-label">çˆ¬å–/åˆ†é’Ÿ</div>
                        <div class="stat-change positive">â†‘ +15%</div>
                    </div>
                </div>

                <!-- Chart -->
                <div class="panel">
                    <div class="panel-header">
                        <span class="panel-title">çˆ¬å–è¶‹åŠ¿ (è¿‘7å¤©)</span>
                    </div>
                    <div class="panel-body">
                        <div class="chart-container">
                            <div class="chart-bars" id="chartBars">
                                <div class="chart-bar" style="height: 40%;" data-value="12"></div>
                                <div class="chart-bar" style="height: 65%;" data-value="18"></div>
                                <div class="chart-bar" style="height: 35%;" data-value="9"></div>
                                <div class="chart-bar" style="height: 80%;" data-value="22"></div>
                                <div class="chart-bar" style="height: 55%;" data-value="15"></div>
                                <div class="chart-bar" style="height: 90%;" data-value="25"></div>
                                <div class="chart-bar" style="height: 70%;" data-value="19"></div>
                            </div>
                            <div class="chart-labels">
                                <span>å‘¨ä¸€</span>
                                <span>å‘¨äºŒ</span>
                                <span>å‘¨ä¸‰</span>
                                <span>å‘¨å››</span>
                                <span>å‘¨äº”</span>
                                <span>å‘¨å…­</span>
                                <span>å‘¨æ—¥</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Distribution -->
                <div class="panel" style="flex: 1;">
                    <div class="panel-header">
                        <span class="panel-title">æ¥æºåˆ†å¸ƒ</span>
                    </div>
                    <div class="panel-body">
                        <div style="display: flex; flex-direction: column; gap: 15px;">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="width: 120px; font-size: 12px; color: var(--text-secondary);">å›½ç¨æ€»å±€</div>
                                <div style="flex: 1; height: 24px; background: var(--bg-tertiary); border: 1px solid var(--border-color); position: relative; overflow: hidden;">
                                    <div style="width: 84.5%; height: 100%; background: linear-gradient(90deg, var(--accent-green), var(--accent-blue)); animation: slideIn 1s;"></div>
                                    <span style="position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); font-size: 11px;">60 æ¡ (84.5%)</span>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="width: 120px; font-size: 12px; color: var(--text-secondary);">å…¨å›½äººå¤§</div>
                                <div style="flex: 1; height: 24px; background: var(--bg-tertiary); border: 1px solid var(--border-color); position: relative; overflow: hidden;">
                                    <div style="width: 5.6%; height: 100%; background: linear-gradient(90deg, var(--accent-orange), var(--accent-red)); animation: slideIn 1s 0.1s;"></div>
                                    <span style="position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); font-size: 11px;">4 æ¡ (5.6%)</span>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="width: 120px; font-size: 12px; color: var(--text-secondary);">å›½åŠ¡é™¢</div>
                                <div style="flex: 1; height: 24px; background: var(--bg-tertiary); border: 1px solid var(--border-color); position: relative; overflow: hidden;">
                                    <div style="width: 5.6%; height: 100%; background: linear-gradient(90deg, var(--accent-blue), var(--accent-green)); animation: slideIn 1s 0.2s;"></div>
                                    <span style="position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); font-size: 11px;">4 æ¡ (5.6%)</span>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="width: 120px; font-size: 12px; color: var(--text-secondary);">å›½å®¶ç¨åŠ¡æ€»å±€</div>
                                <div style="flex: 1; height: 24px; background: var(--bg-tertiary); border: 1px solid var(--border-color); position: relative; overflow: hidden;">
                                    <div style="width: 4.2%; height: 100%; background: linear-gradient(90deg, var(--accent-green), var(--accent-orange)); animation: slideIn 1s 0.3s;"></div>
                                    <span style="position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); font-size: 11px;">3 æ¡ (4.2%)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Activity & Logs -->
            <div style="display: flex; flex-direction: column; gap: 20px;">
                <!-- Activity Feed -->
                <div class="panel">
                    <div class="panel-header">
                        <span class="panel-title">æœ€è¿‘æ´»åŠ¨</span>
                    </div>
                    <div class="panel-body">
                        <div class="activity-list" id="activityList">
                            <div class="activity-item">
                                <div class="activity-icon" style="color: var(--accent-green);">âœ“</div>
                                <div class="activity-content">
                                    <div class="activity-title">çˆ¬è™«æˆåŠŸå®Œæˆ test é˜¶æ®µ</div>
                                    <div class="activity-time">2 åˆ†é’Ÿå‰</div>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon" style="color: var(--accent-blue);">ğŸ”—</div>
                                <div class="activity-content">
                                    <div class="activity-title">æ„å»ºäº† 15 æ¡æ”¿ç­–å…³è”å…³ç³»</div>
                                    <div class="activity-time">15 åˆ†é’Ÿå‰</div>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon" style="color: var(--accent-orange);">âš </div>
                                <div class="activity-content">
                                    <div class="activity-title">æ£€æµ‹åˆ° 3 æ¡é‡å¤æ”¿ç­–</div>
                                    <div class="activity-time">1 å°æ—¶å‰</div>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon" style="color: var(--accent-green);">â–¶</div>
                                <div class="activity-content">
                                    <div class="activity-title">å¯åŠ¨çˆ¬è™« - é˜¶æ®µ: test</div>
                                    <div class="activity-time">2 å°æ—¶å‰</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Log Panel -->
                <div class="panel log-panel">
                    <div class="panel-header">
                        <span class="panel-title">å®æ—¶æ—¥å¿—</span>
                        <button class="btn" style="padding: 5px 10px; font-size: 10px;" id="clearLogs">æ¸…é™¤</button>
                    </div>
                    <div class="log-content" id="logContent">
                        <div class="log-entry info">
                            <span class="log-time">[2026-01-28 23:15:23]</span>
                            <span class="log-message">ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ</span>
                        </div>
                        <div class="log-entry info">
                            <span class="log-time">[2026-01-28 23:15:24]</span>
                            <span class="log-message">è¿æ¥åˆ° MongoDB: localhost:27017</span>
                        </div>
                        <div class="log-entry success">
                            <span class="log-time">[2026-01-28 23:15:25]</span>
                            <span class="log-message">æ•°æ®åº“è¿æ¥æˆåŠŸ</span>
                        </div>
                        <div class="log-entry info">
                            <span class="log-time">[2026-01-28 23:15:26]</span>
                            <span class="log-message">åŠ è½½çˆ¬è™«é…ç½®...</span>
                        </div>
                        <div class="log-entry success">
                            <span class="log-time">[2026-01-28 23:15:27]</span>
                            <span class="log-message">é…ç½®åŠ è½½å®Œæˆï¼Œå½“å‰é˜¶æ®µ: test</span>
                        </div>
                        <div class="log-entry info">
                            <span class="log-time">[2026-01-28 23:15:28]</span>
                            <span class="log-message">ç­‰å¾…å¯åŠ¨å‘½ä»¤...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Panel: Recent Policies -->
        <div class="panel">
            <div class="panel-header">
                <span class="panel-title">æœ€è¿‘çˆ¬å–çš„æ”¿ç­–</span>
                <div style="display: flex; gap: 10px;">
                    <input type="text" placeholder="æœç´¢æ”¿ç­–..." style="padding: 8px 15px; background: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-primary); font-family: 'JetBrains Mono', monospace; font-size: 12px; width: 200px;">
                    <button class="btn" style="padding: 8px 15px; font-size: 11px;">æœç´¢</button>
                </div>
            </div>
            <div class="panel-body">
                <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <thead>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <th style="padding: 12px; text-align: left; color: var(--text-secondary); font-weight: 400; text-transform: uppercase; font-size: 11px;">ID</th>
                            <th style="padding: 12px; text-align: left; color: var(--text-secondary); font-weight: 400; text-transform: uppercase; font-size: 11px;">æ ‡é¢˜</th>
                            <th style="padding: 12px; text-align: left; color: var(--text-secondary); font-weight: 400; text-transform: uppercase; font-size: 11px;">æ¥æº</th>
                            <th style="padding: 12px; text-align: left; color: var(--text-secondary); font-weight: 400; text-transform: uppercase; font-size: 11px;">å±‚çº§</th>
                            <th style="padding: 12px; text-align: left; color: var(--text-secondary); font-weight: 400; text-transform: uppercase; font-size: 11px;">æ—¥æœŸ</th>
                            <th style="padding: 12px; text-align: left; color: var(--text-secondary); font-weight: 400; text-transform: uppercase; font-size: 11px;">çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody id="policyTable">
                        <tr style="border-bottom: 1px solid var(--border-color); transition: background 0.2s;">
                            <td style="padding: 12px; color: var(--accent-green);">#POL_001</td>
                            <td style="padding: 12px;">ä¸­åäººæ°‘å…±å’Œå›½å¢å€¼ç¨æš‚è¡Œæ¡ä¾‹</td>
                            <td style="padding: 12px;"><span class="badge badge-success">chinatax</span></td>
                            <td style="padding: 12px;">L1</td>
                            <td style="padding: 12px; color: var(--text-secondary);">2026-01-28</td>
                            <td style="padding: 12px;"><span style="color: var(--accent-green);">â—</span> å·²å®Œæˆ</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color); transition: background 0.2s;">
                            <td style="padding: 12px; color: var(--accent-green);">#POL_002</td>
                            <td style="padding: 12px;">ä¸­åäººæ°‘å…±å’Œå›½ä¼ä¸šæ‰€å¾—ç¨æ³•</td>
                            <td style="padding: 12px;"><span class="badge badge-success">å…¨å›½äººå¤§</span></td>
                            <td style="padding: 12px;">L1</td>
                            <td style="padding: 12px; color: var(--text-secondary);">2026-01-28</td>
                            <td style="padding: 12px;"><span style="color: var(--accent-green);">â—</span> å·²å®Œæˆ</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color); transition: background 0.2s;">
                            <td style="padding: 12px; color: var(--accent-green);">#POL_003</td>
                            <td style="padding: 12px;">ä¸­åäººæ°‘å…±å’Œå›½ä¸ªäººæ‰€å¾—ç¨æ³•</td>
                            <td style="padding: 12px;"><span class="badge badge-success">å…¨å›½äººå¤§</span></td>
                            <td style="padding: 12px;">L1</td>
                            <td style="padding: 12px; color: var(--text-secondary);">2026-01-28</td>
                            <td style="padding: 12px;"><span style="color: var(--accent-green);">â—</span> å·²å®Œæˆ</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color); transition: background 0.2s;">
                            <td style="padding: 12px; color: var(--accent-green);">#POL_004</td>
                            <td style="padding: 12px;">å¢å€¼ç¨æš‚è¡Œæ¡ä¾‹å®æ–½ç»†åˆ™</td>
                            <td style="padding: 12px;"><span class="badge badge-success">å›½å®¶ç¨åŠ¡æ€»å±€</span></td>
                            <td style="padding: 12px;">L2</td>
                            <td style="padding: 12px; color: var(--text-secondary);">2026-01-28</td>
                            <td style="padding: 12px;"><span style="color: var(--accent-green);">â—</span> å·²å®Œæˆ</td>
                        </tr>
                        <tr style="transition: background 0.2s;">
                            <td style="padding: 12px; color: var(--accent-green);">#POL_005</td>
                            <td style="padding: 12px;">ä¼ä¸šæ‰€å¾—ç¨æ³•å®æ–½æ¡ä¾‹</td>
                            <td style="padding: 12px;"><span class="badge badge-success">å›½åŠ¡é™¢</span></td>
                            <td style="padding: 12px;">L2</td>
                            <td style="padding: 12px; color: var(--text-secondary);">2026-01-28</td>
                            <td style="padding: 12px;"><span style="color: var(--accent-green);">â—</span> å·²å®Œæˆ</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE = 'http://localhost:8000/api/v1/crawler';

        // State
        let currentPhase = 'test';
        let isCrawling = false;
        let stats = null;
        let statusCheckInterval = null;

        // DOM Elements
        const progressRing = document.getElementById('progressRing');
        const progressValue = document.getElementById('progressValue');
        const logContent = document.getElementById('logContent');
        const activityList = document.getElementById('activityList');
        const phaseButtons = document.querySelectorAll('.phase-btn');

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initEventListeners();
            loadInitialData();
            startStatusCheck();
            addLog('ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ', 'info');
            addLog('çˆ¬è™«ç®¡ç†å°å·²å¯åŠ¨', 'success');
        });

        // Load initial data
        async function loadInitialData() {
            await Promise.all([
                fetchStats(),
                fetchLogs(),
                fetchActivities()
            ]);
        }

        // Event Listeners
        function initEventListeners() {
            // Phase buttons
            phaseButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    phaseButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentPhase = btn.dataset.phase;
                    addLog(`åˆ‡æ¢åˆ°é˜¶æ®µ: ${currentPhase}`, 'info');
                });
            });

            // Control buttons
            document.getElementById('startCrawl').addEventListener('click', startCrawl);
            document.getElementById('pauseCrawl').addEventListener('click', pauseCrawl);
            document.getElementById('stopCrawl').addEventListener('click', stopCrawl);
            document.getElementById('buildRelationships').addEventListener('click', buildRelationships);
            document.getElementById('validateData').addEventListener('click', validateData);
            document.getElementById('exportData').addEventListener('click', exportData);
            document.getElementById('clearLogs').addEventListener('click', clearLogs);
        }

        // Fetch stats from API
        async function fetchStats() {
            try {
                const response = await fetch(`${API_BASE}/stats`);
                if (!response.ok) throw new Error('è·å–ç»Ÿè®¡æ•°æ®å¤±è´¥');
                stats = await response.json();
                updateStatsUI(stats);
            } catch (error) {
                console.error('è·å–ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
                // ä½¿ç”¨é»˜è®¤å€¼
                addLog('æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œä½¿ç”¨ç¦»çº¿æ¨¡å¼', 'warning');
            }
        }

        // Update stats UI
        function updateStatsUI(data) {
            // Update total policies
            const totalEl = document.getElementById('totalPolicies');
            if (totalEl) totalEl.textContent = data.total_policies || 0;

            // Update level counts
            const l1Count = data.by_level?.['L1'] || 0;
            const l2Count = data.by_level?.['L2'] || 0;
            const l1El = document.getElementById('l1Count');
            const l2El = document.getElementById('l2Count');
            if (l1El) l1El.textContent = l1Count;
            if (l2El) l2El.textContent = l2Count;

            // Update crawl rate
            const rateEl = document.getElementById('crawlRate');
            if (rateEl) rateEl.textContent = data.crawl_rate?.toFixed(1) || '0.0';

            // Update source distribution (update the bars)
            updateSourceDistribution(data.by_source || {});

            // Update recent policies table
            updateRecentPoliciesTable(data.recent_policies || []);
        }

        // Update source distribution
        function updateSourceDistribution(bySource) {
            const total = Object.values(bySource).reduce((a, b) => a + b, 0) || 1;
            const sources = {
                'chinatax': 'å›½ç¨æ€»å±€',
                'å…¨å›½äººå¤§': 'å…¨å›½äººå¤§',
                'å›½åŠ¡é™¢': 'å›½åŠ¡é™¢',
                'å›½å®¶ç¨åŠ¡æ€»å±€': 'å›½å®¶ç¨åŠ¡æ€»å±€'
            };

            const distributionContainer = document.querySelector('.panel-body:has(.chart-labels)')?.parentElement
                ?.querySelectorAll('.panel-body')[1];

            // This would update the distribution bars dynamically
            // For now, the static HTML will display until we implement dynamic updates
        }

        // Update recent policies table
        function updateRecentPoliciesTable(policies) {
            const tbody = document.getElementById('policyTable');
            if (!tbody || !policies.length) return;

            tbody.innerHTML = policies.slice(0, 5).map(policy => `
                <tr style="border-bottom: 1px solid var(--border-color); transition: background 0.2s;">
                    <td style="padding: 12px; color: var(--accent-green);">#${policy.policy_id || policy._id?.slice(0, 8) || 'UNKNOWN'}</td>
                    <td style="padding: 12px;">${policy.title || 'æœªå‘½åæ”¿ç­–'}</td>
                    <td style="padding: 12px;"><span class="badge badge-success">${policy.source || 'æœªçŸ¥'}</span></td>
                    <td style="padding: 12px;">${policy.level || '-'}</td>
                    <td style="padding: 12px; color: var(--text-secondary);">${new Date(policy.crawled_at || policy.publish_date || Date.now()).toLocaleDateString('zh-CN')}</td>
                    <td style="padding: 12px;"><span style="color: var(--accent-green);">â—</span> å·²å®Œæˆ</td>
                </tr>
            `).join('');
        }

        // Fetch logs from API
        async function fetchLogs() {
            try {
                const response = await fetch(`${API_BASE}/logs?limit=20`);
                if (!response.ok) return;
                const logs = await response.json();
                displayLogs(logs);
            } catch (error) {
                console.error('è·å–æ—¥å¿—å¤±è´¥:', error);
            }
        }

        // Display logs
        function displayLogs(logs) {
            logContent.innerHTML = logs.map(log => `
                <div class="log-entry ${log.level}">
                    <span class="log-time">[${log.timestamp}]</span>
                    <span class="log-message">${log.message}</span>
                </div>
            `).join('');
            logContent.scrollTop = logContent.scrollHeight;
        }

        // Fetch activities from API
        async function fetchActivities() {
            try {
                const response = await fetch(`${API_BASE}/activities?limit=5`);
                if (!response.ok) return;
                const activities = await response.json();
                displayActivities(activities);
            } catch (error) {
                console.error('è·å–æ´»åŠ¨å¤±è´¥:', error);
            }
        }

        // Display activities
        function displayActivities(activities) {
            activityList.innerHTML = activities.map(activity => `
                <div class="activity-item">
                    <div class="activity-icon" style="color: var(--accent-green);">${activity.icon}</div>
                    <div class="activity-content">
                        <div class="activity-title">${activity.title}</div>
                        <div class="activity-time">${activity.time}</div>
                    </div>
                </div>
            `).join('');
        }

        // Start status check interval
        function startStatusCheck() {
            statusCheckInterval = setInterval(async () => {
                await fetchStats();
                await fetchLogs();
                await fetchActivities();
                document.getElementById('lastUpdate').textContent = 'åˆšåˆšæ›´æ–°';
            }, 5000); // Check every 5 seconds
        }

        // Logging
        function addLog(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const time = new Date().toLocaleString('zh-CN');
            entry.innerHTML = `
                <span class="log-time">[${time}]</span>
                <span class="log-message">${message}</span>
            `;
            logContent.appendChild(entry);
            logContent.scrollTop = logContent.scrollHeight;
        }

        // Add activity
        function addActivity(icon, title, time = 'åˆšåˆš') {
            const item = document.createElement('div');
            item.className = 'activity-item';
            item.innerHTML = `
                <div class="activity-icon" style="color: var(--accent-green);">${icon}</div>
                <div class="activity-content">
                    <div class="activity-title">${title}</div>
                    <div class="activity-time">${time}</div>
                </div>
            `;
            activityList.insertBefore(item, activityList.firstChild);
            if (activityList.children.length > 5) {
                activityList.removeChild(activityList.lastChild);
            }
        }

        // Update progress ring
        function updateProgress(percent) {
            const circumference = 2 * Math.PI * 52;
            const offset = circumference - (percent / 100) * circumference;
            progressRing.style.strokeDashoffset = offset;
            progressValue.textContent = `${Math.round(percent)}%`;
        }

        // Crawler controls
        async function startCrawl() {
            if (isCrawling) return;
            isCrawling = true;

            document.getElementById('startCrawl').disabled = true;
            document.getElementById('pauseCrawl').disabled = false;
            document.getElementById('stopCrawl').disabled = false;
            document.getElementById('crawlerStatus').className = 'status-indicator online';
            document.getElementById('crawlerStatusText').textContent = 'çˆ¬è™«è¿è¡Œä¸­';

            addLog(`å¯åŠ¨çˆ¬è™« - é˜¶æ®µ: ${currentPhase}`, 'info');
            addActivity('â–¶', `å¯åŠ¨çˆ¬è™« - é˜¶æ®µ: ${currentPhase}`);

            try {
                const response = await fetch(`${API_BASE}/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phase: currentPhase })
                });

                if (!response.ok) {
                    throw new Error('å¯åŠ¨çˆ¬è™«å¤±è´¥');
                }

                const result = await response.json();
                addLog(result.message, 'success');

                // Start monitoring progress
                monitorProgress(result.task_id);

            } catch (error) {
                addLog(`é”™è¯¯: ${error.message}`, 'error');
                isCrawling = false;
                document.getElementById('startCrawl').disabled = false;
            }
        }

        // Monitor crawl progress
        async function monitorProgress(taskId) {
            const checkInterval = setInterval(async () => {
                try {
                    const response = await fetch(`${API_BASE}/status`);
                    if (!response.ok) return;

                    const status = await response.json();
                    updateProgress(status.progress || 0);

                    if (status.status === 'idle' || status.status === 'completed') {
                        clearInterval(checkInterval);
                        completeCrawl();
                    }
                } catch (error) {
                    console.error('æ£€æŸ¥çŠ¶æ€å¤±è´¥:', error);
                }
            }, 1000);
        }

        async function pauseCrawl() {
            try {
                const response = await fetch(`${API_BASE}/pause`, { method: 'POST' });
                if (!response.ok) throw new Error('æš‚åœå¤±è´¥');

                addLog('çˆ¬è™«å·²æš‚åœ', 'warning');
                addActivity('â¸', 'æš‚åœçˆ¬è™«');

                document.getElementById('pauseCrawl').disabled = true;
                document.getElementById('crawlerStatus').className = 'status-indicator warning';
                document.getElementById('crawlerStatusText').textContent = 'çˆ¬è™«å·²æš‚åœ';
            } catch (error) {
                addLog(`æš‚åœå¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function stopCrawl() {
            try {
                const response = await fetch(`${API_BASE}/stop`, { method: 'POST' });
                if (!response.ok) throw new Error('åœæ­¢å¤±è´¥');

                addLog('çˆ¬è™«å·²åœæ­¢', 'error');
                addActivity('â¹', 'åœæ­¢çˆ¬è™«');

                isCrawling = false;
                updateProgress(0);
                document.getElementById('startCrawl').disabled = false;
                document.getElementById('pauseCrawl').disabled = true;
                document.getElementById('stopCrawl').disabled = true;
                document.getElementById('crawlerStatus').className = 'status-indicator offline';
                document.getElementById('crawlerStatusText').textContent = 'çˆ¬è™«å·²åœæ­¢';
            } catch (error) {
                addLog(`åœæ­¢å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function completeCrawl() {
            isCrawling = false;
            document.getElementById('startCrawl').disabled = false;
            document.getElementById('pauseCrawl').disabled = true;
            document.getElementById('stopCrawl').disabled = true;
            document.getElementById('crawlerStatus').className = 'status-indicator warning';
            document.getElementById('crawlerStatusText').textContent = 'çˆ¬è™«å¾…æœº';
            addLog('çˆ¬è™«ä»»åŠ¡å®Œæˆï¼', 'success');
            addActivity('âœ“', 'çˆ¬è™«æˆåŠŸå®Œæˆ');
            fetchStats(); // Refresh stats
        }

        // Quick actions
        async function buildRelationships() {
            addLog('å¼€å§‹æ„å»ºæ”¿ç­–å…³è”å…³ç³»...', 'info');
            addActivity('ğŸ”—', 'æ„å»ºæ”¿ç­–å…³è”å…³ç³»');

            try {
                const response = await fetch(`${API_BASE}/relationships/build`, { method: 'POST' });
                if (!response.ok) throw new Error('æ„å»ºå…³è”å…³ç³»å¤±è´¥');
                const result = await response.json();
                addLog(result.message, 'success');
            } catch (error) {
                addLog(`é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function validateData() {
            addLog('å¼€å§‹æ•°æ®è´¨é‡éªŒè¯...', 'info');
            addActivity('âœ“', 'éªŒè¯æ•°æ®è´¨é‡');

            try {
                const response = await fetch(`${API_BASE}/data/validate`, { method: 'POST' });
                if (!response.ok) throw new Error('éªŒè¯æ•°æ®å¤±è´¥');
                const result = await response.json();
                addLog(result.message, 'success');
            } catch (error) {
                addLog(`é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function exportData() {
            addLog('å¼€å§‹å¯¼å‡ºæ•°æ®...', 'info');
            addActivity('ğŸ“¥', 'å¯¼å‡ºæ•°æ®');

            try {
                const response = await fetch(`${API_BASE}/export`);
                if (!response.ok) throw new Error('å¯¼å‡ºæ•°æ®å¤±è´¥');
                const data = await response.json();

                // Download the JSON file
                const blob = new Blob([JSON.stringify(data.data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `export_${new Date().toISOString().slice(0, 10)}.json`;
                a.click();
                URL.revokeObjectURL(url);

                addLog(`æ•°æ®å¯¼å‡ºå®Œæˆï¼æ•°é‡: ${data.count}`, 'success');
            } catch (error) {
                addLog(`é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function clearLogs() {
            try {
                await fetch(`${API_BASE}/logs/clear`, { method: 'POST' });
                logContent.innerHTML = '';
                addLog('æ—¥å¿—å·²æ¸…é™¤', 'info');
            } catch (error) {
                addLog(`æ¸…é™¤æ—¥å¿—å¤±è´¥: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
