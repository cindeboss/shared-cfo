# 共享CFO - 爬取方案对齐

## 📊 各层级爬取目标与质量标准

### 目标：覆盖6个层级的完整政策数据

---

## 一、各层级爬取目标详解

### 🔴 第一层：法律（Laws）

**目标数量**：3部
| 法律名称 | 发布日期 | 爬取方式 | 优先级 |
|----------|----------|----------|--------|
| 《中华人民共和国增值税法》 | 2024-12-25 | 从人大官网或税务总局官网 | P0 |
| 《中华人民共和国个人所得税法》 | 2018-08-31 | 同上 | P0 |
| 《中华人民共和国企业所得税法》 | 2007-03-16 | 同上 | P0 |

**质量标准**：
- ⭐⭐⭐⭐⭐ 完整法律全文
- 包含所有条文
- 必须有发文字号或主席令号

---

### 🟠 第二层：行政法规（Regulations）

**目标数量**：3部
| 法规名称 | 发布机关 | 文号 | 爬取方式 |
|----------|----------|------|----------|
| 《中华人民共和国增值税法实施条例》 | 国务院 | 国务院令第826号 | P0 |
| 《中华人民共和国个人所得税法实施条例》 | 国务院 | 国务院令第707号 | P0 |
| 《中华人民共和国企业所得税法实施条例》 | 国务院 | 国务院令第512号 | P0 |

**质量标准**：
- ⭐⭐⭐⭐⭐ 完整条例全文
- 包含所有条文
- 明确的生效日期

---

### 🟡 第三层：部门规章（Rules）

**目标数量**：~100部
**重点领域**：
- 增值税管理类：《增值税一般纳税人登记管理办法》等
- 企业所得税类：《企业所得税税前扣除管理办法》等
- 个人所得税类：《个人所得税扣缴管理办法》等

**爬取来源**：
- 财政部官网（重要）
- 国家税务总局部门规章栏目

**质量标准**：
- ⭐⭐⭐⭐ 包含完整管理办法
- 需要有明确的制定机关
- 需要明确的实施日期

---

### 🟢 第四层：规范性文件（Normative Documents）

**这是最实用、数量最多的一层！**

**目标数量**：~3000条（近3年）
**时间范围**：2023-2025年

**分类**：
1. **税收优惠政策**：各类减免税政策（每年1000+条）
   - 增值税小规模纳税人减免
   - 企业所得税优惠政策
   - 个人所得税专项附加扣除标准

2. **征管措施**：
   - 税务登记管理办法
   - 发票管理办法
   - 纳税评估管理办法

3. **政策延续**：
   - 到期政策延期
   - 政策停止执行

**爬取来源**：
- 国家税务总局政策法规库（主要）
- 财政部官网

**质量标准**：
- ⭐⭐⭐⭐ 发文字号明确
- ⭐⭐⭐⭐ 发布日期明确
- ⭐⭐⭐ 有效期信息明确
- ⭐⭐ 内容详细>500字

---

### 🔵 第五层：官方解读（Interpretations）

**目标数量**：~500条

**类型**：
- 财政部、税务总局联合解读
- 政策答记者问
- 图解、视频、税务讲堂

**爬取来源**：
- 国家税务总局政策解读专栏
- 财政部政策解读

**质量标准**：
- ⭐⭐⭐⭐ 配套原文
- ⭐⭐⭐ 发布机关明确
- ⭐⭐ 关键点清晰

---

### 🟣 第六层：执行口径/操作指引（Guidance）

**目标数量**：~2000条

**类型**：
- 12366热点问答
- 地方税务局执行口径
- 纳税评估案例

**爬取来源**：
- 12366平台（主要）
- 北京/上海/广东/深圳税务局

**质量标准**：
- ⭐⭐⭐ 明确问题
- ⭐⭐ 有明确答案
- ⭐ 标注适用地区

---

## 二、爬取策略设计

### 2.1 分层爬取顺序

```
优先级顺序：
┌─────────────────────────────────────────────────────────┐
│  第一批（P0）     第二批（P1）     第三批（P2）              │
├─────────────────────────────────────────────────────────┤
│                    │                     │                           │
│ 1. 法律        │ 1. 部门规章        │ 1. 地方执行口径            │
│    (3部)        │    (~100部)          │    (~2000条)                │
│                    │                     │                           │
│ 2. 行政法规    │ 2. 规范性文件        │ 2. 12366热点问答            │
│    (3部)        │    (~500条)          │    (~500条)                │
│                    │                     │                           │
│ 3. 官方解读    │ 3. 重要规范性文件    │ 3. 地方政策                  │
│  (~200条)       │    (~200条)          │    (~100条)                │
└─────────────────────────────────────────────────────────┘
```

### 2.2 分阶段实施方案

#### 第一阶段：核心数据（2-3周）

**目标**：完成P0级数据的完整爬取

| 层级 | 数量 | 数据源 | 预计时间 |
|------|------|--------|----------|
| 法律 | 3 | 人大官网或税务总局官网 | 1天 |
| 行政法规 | 3 | 税务总局官网 | 1天 |
| 规范性文件 | 500 | 税务总局政策法规库 | 1周 |
| 官方解读 | 100 | 税务总局政策解读专栏 | 1周 |
| 12366问答 | 100 | 12366平台 | 1周 |

**小计**：706条核心高质量数据

**质量目标**：
- Level 4-5: ≥70%
- 包含文号的: ≥90%
- 包含发布日期的: ≥80%

---

#### 第二阶段：扩展数据（3-4周）

**目标**：补充完善各层级数据

| 层级 | 数量 | 数据源 | 预计时间 |
|------|------|--------|----------|
| 部门规章 | ~100 | 财政部、税务总局 | 1-2周 |
| 规范性文件 | ~1500 | 税务总局+财政部 | 1-2周 |
| 官方解读 | ~400 | 税务总局解读+财税文件解读 | 1-2周 |
| 地方执行口径 | ~1000 | 6个发达省市税务局 | 1-2周 |

**小计**：~3000条扩展数据

---

## 三、数据质量保证机制

### 3.1 字段完整性检查清单

```yaml
必填字段检查:
  - title: ✅ 非空且长度>10
  - source: ✅ 明确的发布机关
  - url: ✅ 可访问的原文链接
  - content: ✅ 内容>200字
  - tax_type: ✅ 至少一个税种
  - region: ✅ 明确适用地域
  - document_type: ✅ 明确文件类型
  - policy_level: ✅ 明确层级

推荐字段检查:
  - document_number: ✅ 发文字号（优先级1）
  - publish_date: ✅ 发布日期（优先级1）
  - effective_date: ⭕ 生效日期（优先级2）
  - expiry_date: ⭕ 失效日期（优先级2）
  - validity_status: ✅ 有效状态（优先级2）
```

### 3.2 字段提取策略

#### 发文字号提取

```python
# 关键模式
1. 财政部文号: 财税〔2024〕1号
2. 税总文号: 税总发〔2024〕1号
3. 公告文号: 国家税务总局公告2024年第1号
4. 国务院令: 国务院令第XXX号
```

#### 日期提取

```python
# 日期提取优先级
优先级1: 成文日期/发布日期
优先级2: 文中日期"2024年1月1日"
优先级3: 根据文号推断（财税〔2024〕1号 → 2024年1月）
```

#### 有效期提取

```python
# 有效期提取关键词
- "执行期限: 2024年1月1日至2027年12月31日"
- "自2024年1月1日起执行"
- "有效期至2027年12月31日"
```

### 3.3 数据质量验证

```python
def validate_policy(doc):
    """政策数据验证"""
    errors = []

    # 检查必填字段
    if not doc.get('title') or len(doc.get('title', '')) < 10:
        errors.append('标题过短或为空')

    if not doc.get('content') or len(doc.get('content', '')) < 100:
        errors.append('内容过短')

    # 检查层级
    if 'policy_level' not in doc:
        errors.append('缺少层级标识')

    # 检查时效性
    if doc.get('validity_status') == 'expired':
        errors.append('政策已过期')

    return {
        'valid': len(errors) == 0,
        'errors': errors,
        'score': len(errors) == 0
    }
```

---

## 四、技术实现要点

### 4.1 层级识别逻辑

```python
def determine_policy_level(title, content):
    """自动识别政策层级"""
    # 第1层：法律
    if '中华人民共和国.*?法' in title and '全国人民代表大会' in content:
        return 1

    # 第2层：行政法规
    if '实施条例' in title and '国务院' in content:
        return 2

    # 第3层：部门规章
    if '管理办法' in title or '实施细则' in title:
        return 3

    # 第5层：官方解读
    if '解读' in title or '答记者问' in title:
        return 5

    # 第6层：执行口径
    if '12366' in title or '热点问题' in title:
        return 6

    # 第4层：规范性文件（默认）
    return 4
```

### 4.2 数据去重策略

```python
# 去重字段（优先级）
1. policy_id: 由"来源+年份+序号"生成
2. title + source + publish_date的组合

# 去重规则
- 同一policy_id：直接跳过
- 标题完全相同+来源相同：跳过
- 标题+文号相同：更新现有文档
```

### 4.3 质量评分标准

```python
def calculate_quality_score(doc):
    """
    质量评分 (0-100分)

    评分维度：
    1. 字段完整性 (30分)
       - 发文字号: +10分
       - 发布日期: +10分
       - 标题长度: +10分

    2. 内容质量 (40分)
       - 内容>500字: +10分
       - 内容>1000字: +10分
       - 有配套解读: +10分
       - 条理清晰: +10分

    3. 时效性 (20分)
       - 有生效日期: +10分
       - 有失效日期: +10分

    4. 结构化程度 (10分)
       - 税种分类明确: +5分
       - 地域明确: +5分

    质量等级：
    - Level 5 (90-100分): 优秀
    - Level 4 (75-89分): 良好
    - Level 3 (60-74分): 合格
    - Level 2 (40-59分): 基础
    - Level 1 (0-39分): 较差
```

---

## 五、执行检查清单

### 5.1 爬取前检查

- [ ] 确认MongoDB正常运行
- [ ] 确认Playwright可用
- [ ] 确认网络可访问目标网站
- [ ] 确认有足够存储空间

### 5.2 爬取中检查

- [ ] 检查是否有403/429错误
- [ ] 检查是否有超时
- [ ] 检查字段提取是否正常

### 5.5 爬取后验证

- [ ] 检查数据是否插入成功
- [ ] 检查各层级数据数量是否符合预期
- [ ] 检查数据质量分数分布
- [ ] 检查是否有重复数据

---

## 六、成功标准

### 6.1 数据完整性标准

```
总数据量: ≥ 1000条
层级分布:
├── 法律: 3条
├── 行政法规: 3条
├── 部门规章: ≥10条
├── 规范性文件: ≥500条
├── 官方解读: ≥50条
└── 执行口径: ≥20条

字段完整性:
├── 包含发文字号: ≥80%
├── 包含发布日期: ≥80%
├── 内容>200字: ≥90%
└── 明确层级标注: 100%
```

### 6.2 质量目标

```
Level 4-5质量数据占比: ≥60%
包含文号+日期的政策占比: ≥70%
有效状态明确的数据占比: ≥80%
```

---

## 七、风险控制

### 7.1 技术风险及应对

| 风险 | 应对措施 |
|------|----------|
| 网站反爬虫 | Playwright + 指数退避 + 降低频率 |
| 网站结构变化 | 定期检查 + 备用方案 |
| 网站超时 | 降低超时时间 + 重试机制 |

### 7.2 数据质量风险及控制

| 风险 | 应对措施 |
|------|----------|
| 重复数据 | policy_id唯一约束 + 内容去重 |
| 错误层级识别 | 关键词+上下文判断 |
| 文号提取失败 | 多模式尝试 + 置信度评分 |
| 日期解析失败 | 容错处理 + 推断日期 |

---

## 八、下一步行动

### ✓ 已完成

1. ✅ 数据模型设计完成
2. ✅ 字段提取器实现完成
3. ✅ 爬虫框架完成

### 🔄 待确认

1. 是否开始执行爬虫？
2. 是否需要调整某些标准？
3. 是否有特定的税种优先级？（比如先爬增值税相关？）
4. 是否需要先创建一个测试脚本验证功能？

---

准备好开始执行爬虫了吗？或者还需要讨论其他细节？
