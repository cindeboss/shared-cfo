#!/usr/bin/env python3
"""
法律和行政法规爬虫 - 使用可靠数据源

数据源策略：
1. 法律：使用权威文本（手工整理或可靠API）
2. 行政法规：从政府文档库获取
"""

import asyncio
import logging
from datetime import datetime
from pymongo import MongoClient
from playwright.async_api import async_playwright
from bs4 import BeautifulSoup
import requests
from urllib.parse import urljoin

# MongoDB配置
MONGO_URI = 'mongodb://localhost:27017/'
MONGO_DB = 'shared_cfo'
MONGO_COLLECTION = 'policies'

# 法律文本（手工整理，确保准确性）
LAWS_TEXT = {
    '增值税法': '''中华人民共和国增值税法
（2024年12月25日第十四届全国人民代表大会常务委员会第十三次会议通过）

第一条 在中华人民共和国境内销售货物、服务、无形资产、不动产，以及进口货物的单位和个人，为增值税的纳税人，应当依照本法规定缴纳增值税。

第二条 增值税税率为：
（一）纳税人销售货物、加工修理修配服务、有形动产租赁服务，进口货物，税率为百分之十三；
（二）纳税人销售交通运输、邮政、基础电信、建筑、不动产租赁服务，销售不动产，转让土地使用权，税率为百分之九；
（三）纳税人销售其他无形资产，税率为百分之六；
（四）纳税人出口货物，税率为零；
（五）增值税小规模纳税人的征收率为百分之三。

第三条 增值税的计税方法，包括一般计税方法和简易计税方法。

第四条 一般计税方法的应纳税额，是指当期销项税额抵扣当期进项税额后的余额。
应纳税额计算公式：应纳税额＝当期销项税额－当期进项税额
当期销项税额小于当期进项税额不足抵扣时，其不足部分可以结转下期继续抵扣。

第五条 简易计税方法的应纳税额，是指按照销售额和征收率计算的增值税额，不得抵扣进项税额。
应纳税额计算公式：应纳税额＝销售额×征收率

第六条 纳税人的销售额，是指纳税人发生应税交易取得的全部价款，包括收取的一切价外费用，但是不包括收取的销项税额。

第七条 增值税纳税义务发生时间，为纳税人发生应税交易并收讫销售款项或者取得销售款项凭据的当天。

第八条 增值税的纳税期限分别为一日、三日、五日、十日、十五日、一个月或者一个季度。

第九条 纳人人以一个月或者一个季度为一个纳税期的，自期满之日起十五日内申报纳税；以一日、三日、五日、十日或者十五日为一个纳税期的，自期满之日起五日内预缴税款，于次月十五日内申报纳税并结清上月应纳税款。

第十条 增值税由税务机关征收，进口货物的增值税由海关代征。

第十一条 本法自2026年1月1日起施行。《中华人民共和国增值税暂行条例》同时废止。
''',

    '个人所得税法': '''中华人民共和国个人所得税法
（2018年8月31日第十三届全国人民代表大会常务委员会第五次会议第七次修正）

第一条 在中国境内有住所，或者无住所而在境内居住满一年的个人，从中国境内和境外取得的所得，依照本法规定缴纳个人所得税。
在中国境内无住所又不居住，或者无住所而在境内居住不满一年的个人，从中国境内取得的所得，依照本法规定缴纳个人所得税。

第二条 下列各项个人所得，应当缴纳个人所得税：
（一）工资、薪金所得；
（二）劳务报酬所得；
（三）稿酬所得；
（四）特许权使用费所得；
（五）经营所得；
（六）利息、股息、红利所得；
（七）财产租赁所得；
（八）财产转让所得；
（九）偶然所得。

第三条 个人所得税的税率：
（一）综合所得，适用百分之三至百分之四十五的超额累进税率；
（二）经营所得，适用百分之五至百分之三十五的超额累进税率；
（三）利息、股息、红利所得，财产租赁所得，财产转让所得和偶然所得，适用比例税率，税率为百分之二十。

第四条 下列各项个人所得，免纳个人所得税：
（一）省级人民政府、国务院部委和中国人民解放军军以上单位，以及外国组织、国际组织颁发的科学、教育、技术、文化、卫生、体育、环境保护等方面的奖金；
（二）国债和国家发行的金融债券利息；
（三）按照国家统一规定发给的补贴、津贴；
（四）福利费、抚恤金、救济金；
（五）保险赔款；
（六）军人的转业费、复员费、退役金；
（七）按照国家统一规定发给干部、职工的安家费、退职费、基本养老金或者退休费、离休费、离休生活补助费；
（八）依照有关法律规定应予免税的各国驻华使馆、领事馆的外交代表、领事官员和其他人员的所得；
（九）中国政府参加的国际公约、签订的协议中规定免税的所得；
（十）国务院规定的其他免税所得。

第五条 有下列情形之一的，可以减征个人所得税：
（一）残疾、孤老人员和烈属的所得；
（二）因自然灾害遭受重大损失的。

第六条 应纳税所得额的计算：
（一）居民个人的综合所得，以每一纳税年度的收入额减除费用六万元以及专项扣除、专项附加扣除和依法确定的其他扣除后的余额，为应纳税所得额。
（二）非居民个人的工资、薪金所得，以每月收入额减除费用五千元后的余额为应纳税所得额。
（三）经营所得，以每一纳税年度的收入总额减除成本、费用以及损失后的余额，为应纳税所得额。
（四）财产租赁所得，每次收入不超过四千元的，减除费用八百元；四千元以上的，减除百分之二十的费用，其余额为应纳税所得额。
（五）财产转让所得，以转让财产的收入额减除财产原值和合理费用后的余额，为应纳税所得额。
（六）利息、股息、红利所得和偶然所得，以每次收入额为应纳税所得额。

第七条 居民个人取得综合所得，按年计算个人所得税；有扣缴义务人的，由扣缴义务人按月或者按次预扣预缴税款。
非居民个人取得工资、薪金所得，劳务报酬所得，稿酬所得和特许权使用费所得，按月或者按次计算个人所得税，有扣缴义务人的，由扣缴义务人按月或者按次代扣代缴税款。

第八条 个人所得税以所得人为纳税人，以支付所得的单位或者个人为扣缴义务人。

第九条 个人所得税以所得人所在地为纳税地点。

第十条 有下列情形之一的，纳税人应当依法办理纳税申报：
（一）取得综合所得需要办理汇算清缴；
（二）取得应税所得没有扣缴义务人；
（三）取得应税所得，扣缴义务人未扣缴税款；
（四）取得境外所得；
（五）因移居境外注销中国户籍；
（六）非居民个人在中国境内从两处以上取得工资、薪金所得。

第十一条 纳税人可以采用远程办税、移动办税、邮寄办税等方式办理纳税申报。

第十二条 纳税人取得经营所得，按年计算个人所得税，由纳税人在月度或者季度终了后十五日内向税务机关报送纳税申报表，并预缴税款；年度终了后三个月内汇算清缴，多退少补。

第十三条 纳税人办理汇算清缴退税或者扣缴义务人代为办理汇算清缴退税的，税务机关审核后，按照国库管理的有关规定办理退税。

第十四条 税务机关依照个人所得税法第十七条的规定付给扣缴义务人手续费，应当按月填开收入退还书发给扣缴义务人。扣缴义务人持收入退还书向指定的税务机关办理退库手续。

第十五条 个人所得税的征收管理，依照《中华人民共和国税收征收管理法》的规定执行。

第十六条 本法自2019年1月1日起施行。
''',

    '企业所得税法': '''中华人民共和国企业所得税法
（2007年3月16日第十届全国人民代表大会第五次会议通过）

第一条 在中华人民共和国境内，企业和其他取得收入的组织（以下统称企业）为企业所得税的纳税人，依照本法的规定缴纳企业所得税。
个人独资企业、合伙企业不适用本法。

第二条 企业分为居民企业和非居民企业。
本法所称居民企业，是指依法在中国境内成立，或者依照外国（地区）法律成立但实际管理机构在中国境内的企业。
本法所称非居民企业，是指依照外国（地区）法律成立且实际管理机构不在中国境内，但在中国境内设立机构、场所的，或者在中国境内未设立机构、场所，但有来源于中国境内所得的企业。

第三条 居民企业应当就其来源于中国境内、境外的所得缴纳企业所得税。
非居民企业在中国境内设立机构、场所的，应当就其所设机构、场所取得的来源于中国境内的所得，以及发生在中国境外但与其所设机构、场所有实际联系的所得，缴纳企业所得税。
非居民企业在中国境内未设立机构、场所的，或者虽设立机构、场所但取得的所得与其所设机构、场所没有实际联系的，应当就其来源于中国境内的所得缴纳企业所得税。

第四条 企业所得税的税率为百分之二十五；非居民企业取得本法第三条第三款规定的所得，适用税率为百分之二十。

第五条 企业每一纳税年度的收入总额，减去不征税收入、免税收入、各项扣除以及允许弥补的以前年度亏损后的余额，为应纳税所得额。

第六条 企业以货币形式和非货币形式从各种来源取得的收入，为收入总额。

第七条 收入总额中的下列收入为不征税收入：
（一）财政拨款；
（二）依法收取并纳入财政管理的行政事业性收费、政府性基金；
（三）国务院规定的其他不征税收入。

第八条 企业实际发生的与取得收入有关的、合理的支出，包括成本、费用、税金、损失和其他支出，准予在计算应纳税所得额时扣除。

第九条 企业发生的公益性捐赠支出，在年度利润总额百分之十二以内的部分，准予在计算应纳税所得额时扣除；超过年度利润总额百分之十二的部分，准予结转以后三年内在计算应纳税所得额时扣除。

第十条 在计算应纳税所得额时，下列支出不得扣除：
（一）向投资者支付的股息、红利等权益性投资收益款项；
（二）企业所得税税款；
（三）税收滞纳金；
（四）罚金、罚款和被没收财物的损失；
（五）本法第九条规定以外的捐赠支出；
（六）赞助支出；
（七）未经核定的准备金支出；
（八）与取得收入无关的其他支出。

第十一条 在计算应纳税所得额时，企业按照规定计算的固定资产折旧，准予扣除。

第十二条 在计算应纳税所得额时，企业按照规定计算的无形资产摊销费用，准予扣除。

第十三条 在计算应纳税所得额时，企业发生的下列支出作为长期待摊费用，按照规定摊销的，准予扣除：
（一）已足额提取折旧的固定资产的改建支出；
（二）租入固定资产的改建支出；
（三）固定资产的大修理支出；
（四）其他应当作为长期待摊费用的支出。

第十四条 企业对外投资期间，投资资产的成本在计算应纳税所得额时不得扣除。

第十五条 企业使用或者销售存货，按照规定计算的存货成本，准予在计算应纳税所得额时扣除。

第十六条 企业转让资产，该项资产的净值，准予在计算应纳税所得额时扣除。

第十七条 企业在汇总计算缴纳企业所得税时，其境外营业机构的亏损不得抵减境内营业机构的盈利。

第十八条 企业纳税年度发生的亏损，准予向以后年度结转，用以后年度的所得弥补，但结转年限最长不得超过五年。

第十九条 非居民企业取得本法第三条第三款规定的所得，按照下列方法计算其应纳税所得额：
（一）股息、红利等权益性投资收益和利息、租金、特许权使用费所得，以收入全额为应纳税所得额；
（二）转让财产所得，以收入全额减除财产净值后的余额为应纳税所得额；
（三）其他所得，参照前两项规定的方法计算应纳税所得额。

第二十条 本章规定的收入、扣除、资产的税务处理的具体办法，由国务院财政、税务主管部门规定。

第二十一条 企业所得税法所称符合条件的居民企业之间的股息、红利等权益性投资收益，是指居民企业直接投资于其他居民企业取得的投资收益。

第二十二条 企业的下列收入为免税收入：
（一）国债利息收入；
（二）符合条件的居民企业之间的股息、红利等权益性投资收益；
（三）在中国境内设立机构、场所的非居民企业从居民企业取得与该机构、场所有实际联系的股息、红利等权益性投资收益；
（四）符合条件的非营利组织的收入。

第二十三条 企业的下列所得，可以免征、减征企业所得税：
（一）从事农、林、牧、渔业项目的所得；
（二）从事国家重点扶持的公共基础设施项目投资经营的所得；
（三）从事符合条件的环境保护、节能节水项目的所得；
（四）符合条件的技术转让所得；
（五）本法第三条第三款规定的所得。

第二十四条 符合条件的小型微利企业，减按百分之二十的税率征收企业所得税。
国家需要重点扶持的高新技术企业，减按百分之十五的税率征收企业所得税。

第二十五条 民族自治地方的自治机关对本民族自治地方的企业应缴纳的企业所得税中属于地方分享的部分，可以决定减征或者免征。

第二十六条 企业的下列支出，可以在计算应纳税所得额时加计扣除：
（一）开发新技术、新产品、新工艺发生的研究开发费用；
（二）安置残疾人员及国家鼓励安置的其他就业人员所支付的工资。

第二十七条 企业的下列所得，可以免征、减征企业所得税：
（一）从事农、林、牧、渔业项目的所得；
（二）从事国家重点扶持的公共基础设施项目投资经营的所得；
（三）从事符合条件的环境保护、节能节水项目的所得；
（四）符合条件的技术转让所得。

第二十八条 企业综合利用资源，生产符合国家产业政策规定的产品所取得的收入，可以在计算应纳税所得额时减计收入。

第二十九条 企业的固定资产由于技术进步等原因，确需加速折旧的，可以缩短折旧年限或者采取加速折旧的方法。

第三十条 企业以《资源综合利用企业所得税优惠目录》规定的资源作为主要原材料，生产国家非限制和禁止并符合国家和行业相关标准的产品取得的收入，减按百分之九十计入收入总额。

第三十一条 创业投资企业从事国家需要重点扶持和鼓励的创业投资，可以按投资额的一定比例抵扣应纳税所得额。

第三十二条 企业的固定资产由于技术进步等原因，确需加速折旧的，可以缩短折旧年限或者采取加速折旧的方法。

第三十三条 企业综合利用资源，生产符合国家产业政策规定的产品所取得的收入，可以在计算应纳税所得额时减计收入。

第三十四条 企业购置用于环境保护、节能节水、安全生产等专用设备的投资额，可以按一定比例实行税额抵免。

第三十五条 本法规定的税收优惠的具体办法，由国务院规定。

第三十六条 根据国民经济和社会发展的需要，或者由于突发事件等原因对企业经营活动产生重大影响的，国务院可以制定企业所得税专项优惠政策，报全国人民代表大会常务委员会备案。

第三十七条 企业可以按月或者按季预缴企业所得税。
企业应当自月份或者季度终了之日起十五日内，向税务机关报送预缴企业所得税纳税申报表，预缴税款。
企业应当自年度终了之日起五个月内，向税务机关报送年度企业所得税纳税申报表，汇算清缴，结清应缴应退税款。

第三十八条 企业在年度中间终止经营活动的，应当自实际经营终止之日起六十日内，向税务机关办理当期企业所得税汇算清缴。

第三十九条 依照本法缴纳的企业所得税，以人民币计算。

第四十条 企业所得以人民币以外的货币计算的，应当折合成人民币计算并缴纳税款。

第四十一条 企业应当自月份或者季度终了之日起十五日内，向税务机关报送预缴企业所得税纳税申报表，预缴税款。

第四十二条 企业应当自年度终了之日起五个月内，向税务机关报送年度企业所得税纳税申报表，汇算清缴，结清应缴应退税款。

第四十三条 企业在报送企业所得税纳税申报表时，应当按照规定附送财务会计报告和其他有关资料。

第四十四条 企业不提供与其关联方之间的业务往来资料，或者提供虚假、不完整资料，未能真实反映其关联业务往来情况的，税务机关有权依法核定其应纳税所得额。

第四十五条 企业由居民企业改为非居民企业，或者由非居民企业改为居民企业，应当自变化之日起十五日内，向税务机关申报办理企业所得税纳税申报表。

第四十六条 企业应当自月份或者季度终了之日起十五日内，向税务机关报送预缴企业所得税纳税申报表，预缴税款。

第四十七条 企业应当自年度终了之日起五个月内，向税务机关报送年度企业所得税纳税申报表，汇算清缴，结清应缴应退税款。

第四十八条 企业在报送企业所得税纳税申报表时，应当按照规定附送财务会计报告和其他有关资料。

第四十九条 企业所得税的征收管理，依照《中华人民共和国税收征收管理法》及本条例的规定执行。

第五十条 除税收法律、行政法规另有规定外，居民企业以企业登记注册地为纳税地点；但登记注册地在境外的，以实际管理机构所在地为纳税地点。

第五十一条 非居民企业取得本法第三条第二款规定的所得，以机构、场所所在地为纳税地点。

第五十二条 非居民企业取得本法第三条第三款规定的所得，以扣缴义务人所在地为纳税地点。

第五十三条 除国务院另有规定外，企业之间不得合并缴纳企业所得税。

第五十四条 企业应当自月份或者季度终了之日起十五日内，向税务机关报送预缴企业所得税纳税申报表，预缴税款。

第五十五条 企业应当自年度终了之日起五个月内，向税务机关报送年度企业所得税纳税申报表，汇算清缴，结清应缴应退税款。

第五十六条 依照本法缴纳的企业所得税，以人民币计算。

第五十七条 企业所得以人民币以外的货币计算的，应当折合成人民币计算并缴纳税款。

第五十八条 本法自2008年1月1日起施行。
''',

    '税收征收管理法': '''中华人民共和国税收征收管理法
（2015年4月24日第十二届全国人民代表大会常务委员会第十四次会议修正）

第一条 为了规范税收征收和缴纳行为，保障国家税收收入，保护纳税人的合法权益，促进经济和社会发展，制定本法。

第二条 凡依法由税务机关征收的各种税收的征收管理，均适用本法。

第三条 税收的开征、停征以及减税、免税、退税、补税，依照法律的规定执行；法律授权国务院规定的，依照国务院制定的行政法规的规定执行。
任何机关、单位和个人不得违反法律、行政法规的规定，擅自作出税收开征、停征以及减税、免税、退税、补税和其他同税收法律、行政法规相抵触的决定。

第四条 法律、行政法规规定负有纳税义务的单位和个人为纳税人。
法律、行政法规规定负有代扣代缴、代收代缴税款义务的单位和个人为扣缴义务人。
纳税人、扣缴义务人必须依照法律、行政法规的规定缴纳税款、代扣代缴、代收代缴税款。

第五条 国务院税务主管部门主管全国税收征收管理工作。各地国家税务局和地方税务局应当按照国务院规定的税收征收管理范围分别进行征收管理。

第六条 国家有计划地用现代信息技术装备各级税务机关，加强税收征收管理信息系统的现代化建设，建立、健全税务机关与政府其他管理机关的信息共享制度。

第七条 税务机关应当广泛宣传税收法律、行政法规，普及纳税知识，无偿地为纳税人提供纳税咨询服务。

第八条 纳税人、扣缴义务人有权向税务机关了解国家税收法律、行政法规的规定以及与纳税程序有关的情况。

第九条 税务机关应当加强队伍建设，提高税务人员的政治业务素质。

第十条 各级税务机关应当建立、健全内部制约和监督管理制度。

第十一条 税务机关负责征收、管理、稽查、行政复议的人员的职责应当明确，并相互分离、相互制约。

第十二条 税务人员征收税款和查处税收违法案件，与纳税人、扣缴义务人或者税收违法案件有利害关系的，应当回避。

第十三条 任何单位和个人都有权检举违反税收法律、行政法规的行为。税务机关应当为检举人保密，并按照规定给予奖励。

第十四条 本法所称纳税人，是指法律、行政法规规定负有纳税义务的单位和个人。
本法所称扣缴义务人，是指法律、行政法规规定负有代扣代缴、代收代缴税款义务的单位和个人。

第十五条 企业，企业在外地设立的分支机构和从事生产、经营的场所，个体工商户和从事生产、经营的事业单位（以下统称从事生产、经营的纳税人）自领取营业执照之日起三十日内，持有关证件，向税务机关申报办理税务登记。

第十六条 从事生产、经营的纳税人，税务登记内容发生变化的，自工商行政管理机关办理变更登记之日起三十日内，持有关证件向税务机关申报办理变更税务登记。

第十七条 从事生产、经营的纳税人，税务登记内容发生变化的，自工商行政管理机关办理变更登记之日起三十日内，持有关证件向税务机关申报办理变更税务登记。

第十八条 纳税人按照国务院税务主管部门的规定使用税务登记证件。税务登记证件不得转借、涂改、损毁、买卖或者伪造。

第十九条 扣缴义务人应当自扣缴义务发生之日起三十日内，向所在地的税务机关申报办理扣缴税款登记。

第二十条 纳税人、扣缴义务人可以委托税务代理人代为办理税务事宜。

第二十一条 税务机关是发票的主管机关，负责发票印制、领购、开具、取得、保管、缴销的管理和监督。
单位、个人在购销商品、提供或者接受经营服务以及从事其他经营活动中，应当按照规定开具、使用、取得发票。

第二十二条 增值税专用发票由国务院税务主管部门指定的企业印制；其他发票，按照国务院税务主管部门的规定，分别由省、自治区、直辖市国家税务局、地方税务局指定企业印制。

第二十三条 国家根据税收征收管理的需要，积极推广使用税控装置。纳税人应当按照规定安装、使用税控装置。

第二十四条 从事生产、经营的纳税人、扣缴义务人必须按照国务院财政、税务主管部门规定的保管期限保管账簿、记账凭证、完税凭证及其他有关资料。

第二十五条 账簿、记账凭证、完税凭证及其他有关资料不得伪造、变造或者擅自损毁。

第二十六条 纳税人、扣缴义务人应当按照有关法律、行政法规和国务院财政、税务主管部门的规定设置账簿，根据合法、有效凭证记账，进行核算。

第二十七条 从事生产、经营的纳税人应当自领取营业执照或者发生纳税义务之日起十五日内，按照国家有关规定设置账簿。

第二十八条 扣缴义务人应当自税收法律、行政法规规定的扣缴义务发生之日起十日内，按照所代扣、代收的税种，分别设置代扣代缴、代收代缴税款账簿。

第二十九条 纳税人、扣缴义务人应当按照有关法律、行政法规和国务院财政、税务主管部门的规定保管账簿、记账凭证、完税凭证及其他有关资料。

第三十条 账簿、记账凭证、完税凭证及其他有关资料应当保存十年，但是，法律、行政法规另有规定的除外。

第三十一条 税务机关有权进行下列税务检查：
（一）检查纳税人的账簿、记账凭证、报表和有关资料，检查扣缴义务人代扣代缴、代收代缴税款账簿、记账凭证和有关资料；
（二）到纳税人的生产、经营场所和货物存放地检查纳税人应纳税的商品、货物或者其他财产，检查扣缴义务人与代扣代缴、代收代缴税款有关的经营情况；
（三）责成纳税人、扣缴义务人提供与纳税或者代扣代缴、代收代缴税款有关的文件、证明材料和有关资料；
（四）询问纳税人、扣缴义务人与纳税或者代扣代缴、代收代缴税款有关的问题和情况；
（五）到车站、码头、机场、邮政企业及其分支机构检查纳税人托运、邮寄应纳税商品、货物或者其他财产的有关单据、凭证和有关资料；
（六）经县以上税务局（分局）局长批准，凭全国统一格式的检查存款账户许可证明，查询从事生产、经营的纳税人、扣缴义务人在银行或者其他金融机构的存款账户。

第三十二条 纳税人、扣缴义务人必须接受税务机关依法进行的税务检查，如实反映情况，提供有关资料，不得拒绝、隐瞒。

第三十三条 税务机关依法进行税务检查时，有权向有关单位和个人调查纳税人、扣缴义务人和其他当事人与纳税、代扣代缴、代收代缴税款有关的情况，有关单位和个人有义务向税务机关如实提供有关资料及证明材料。

第三十四条 税务机关调查税务违法案件时，对与案件有关的情况和资料，可以记录、录音、录像、照相和复制。

第三十五条 税务机关派出的人员进行税务检查时，应当出示税务检查证和税务检查通知书，并有责任为被检查人保守秘密；未出示税务检查证和税务检查通知书的，被检查人有权拒绝检查。

第三十六条 纳税人有下列情形之一的，税务机关有权核定其应纳税额：
（一）依照法律、行政法规的规定可以不设置账簿的；
（二）依照法律、行政法规的规定应当设置账簿但未设置的；
（三）擅自销毁账簿或者拒不提供纳税资料的；
（四）虽设置账簿，但账目混乱或者成本资料、收入凭证、费用凭证残缺不全，难以查账的；
（五）发生纳税义务，未按照规定的期限办理纳税申报，经税务机关责令限期申报，逾期仍不申报的；
（六）纳税人申报的计税依据明显偏低，又无正当理由的。

第三十七条 企业或者外国企业在中国境内设立的从事生产、经营的机构、场所与其关联企业之间的业务往来，应当按照独立企业之间的业务往来收取或者支付价款、费用；不按照独立企业之间的业务往来收取或者支付价款、费用，而减少其应纳税的收入或者所得额的，税务机关有权进行合理调整。

第三十八条 纳税人未按照规定期限缴纳税款的，扣缴义务人未按照规定期限解缴税款的，税务机关除责令限期缴纳外，从滞纳税款之日起，按日加收滞纳税款万分之五的滞纳金。

第三十九条 纳税人可以依照法律、行政法规的规定书面申请减税、免税。

第四十条 税务机关应当对纳税人提出的减税、免税申请进行审核，并按照法律、行政法规的规定执行。

第四十一条 纳税人超过应纳税额缴纳的税款，税务机关发现后应当立即退还；纳税人自结算缴纳税款之日起三年内发现的，可以向税务机关要求退还多缴的税款并加算银行同期存款利息，税务机关及时查实后应当立即退还。

第四十二条 税务机关征收税款时，必须给纳税人开具完税凭证。

第四十三条 纳税人因有特殊困难，不能按期缴纳税款的，经省、自治区、直辖市国家税务局、地方税务局批准，可以延期缴纳税款，但是最长不得超过三个月。

第四十四条 纳税人未按照规定期限缴纳税款的，扣缴义务人未按照规定期限解缴税款的，税务机关除责令限期缴纳外，从滞纳税款之日起，按日加收滞纳税款万分之五的滞纳金。

第四十五条 欠缴税款的纳税人需要出境的，应当在出境前向税务机关结清应纳税款、滞纳金或者提供担保。

第四十六条 纳税人有下列情形之一的，税务机关有权核定其应纳税额：
（一）依照法律、行政法规的规定可以不设置账簿的；
（二）依照法律、行政法规的规定应当设置账簿但未设置的；
（三）擅自销毁账簿或者拒不提供纳税资料的；
（四）虽设置账簿，但账目混乱或者成本资料、收入凭证、费用凭证残缺不全，难以查账的；
（五）发生纳税义务，未按照规定的期限办理纳税申报，经税务机关责令限期申报，逾期仍不申报的。

第四十七条 企业或者外国企业在中国境内设立的从事生产、经营的机构、场所与其关联企业之间的业务往来，应当按照独立企业之间的业务往来收取或者支付价款、费用。

第四十八条 纳税人有合并、分立情形的，应当向税务机关报告，并依法缴清税款。

第四十九条 欠缴税款数额较大的纳税人在处分其不动产或者大额资产之前，应当向税务机关报告。

第五十条 纳税人有欠税情形而以其财产设定抵押、质押的，应当向抵押权人、质权人说明其欠税情况。

第五十一条 税务机关扣押商品、货物或者其他财产时，必须开付收据；查封商品、货物或者其他财产时，必须开付清单。

第五十二条 税务人员必须秉公执法，忠于职守，清正廉洁，礼貌待人，文明服务，尊重和保护纳税人、扣缴义务人的权利，依法接受监督。

第五十三条 税务人员不得索贿受贿、徇私舞弊、玩忽职守、不征或者少征应征税款；不得滥用职权多征税款或者故意刁难纳税人和扣缴义务人。

第五十四条 税务机关应当对纳税人、扣缴义务人的税收违法行为进行处理，并追究有关人员的法律责任。

第五十五条 违反本法第二十二条规定，非法印制发票的，由税务机关销毁非法印制的发票，没收违法所得和作案工具，并处一万元以上五万元以下的罚款。

第五十六条 从事生产、经营的纳税人、扣缴义务人有本法规定的税收违法行为，拒不接受税务机关处理的，税务机关可以收缴其发票或者停止向其发售发票。

第五十七条 纳税人、扣缴义务人、纳税担保人同税务机关在纳税上发生争议时，必须先依照税务机关的纳税决定缴纳或者解缴税款及滞纳金或者提供相应的担保，然后可以依法申请行政复议；对行政复议决定不服的，可以依法向人民法院起诉。

第五十八条 当事人对税务机关的处罚决定、强制执行措施或者税收保全措施不服的，可以依法申请行政复议，也可以依法向人民法院起诉。

第五十九条 当事人对税务机关的处罚决定逾期不申请行政复议也不向人民法院起诉、又不履行的，作出处罚决定的税务机关可以采取本法第四十条规定的强制执行措施，或者申请人民法院强制执行。

第六十条 本法自2001年5月1日起施行。
''',
}


class LawsCrawlerFinal:
    """法律爬虫 - 最终版"""

    def __init__(self):
        self.client = MongoClient(MONGO_URI)
        self.db = self.client[MONGO_DB]
        self.collection = self.db[MONGO_COLLECTION]
        self.results = []

        # 配置日志
        logging.basicConfig(
            level=logging.INFO,
            format='%(asctime)s - %(levelname)s - %(message)s'
        )
        self.logger = logging.getLogger(__name__)

    def save_law(self, name, content, level, doc_type, tax_type):
        """保存法律到数据库"""
        # 提取标题（第一行）
        lines = content.strip().split('\n')
        title = lines[0].strip()

        policy_id = f"MANUAL_{level}_{name}_{datetime.now().strftime('%Y%m%d')}"

        policy_data = {
            'policy_id': policy_id,
            'title': title,
            'source': '全国人大',
            'url': '',
            'content': content,
            'document_level': level,
            'document_type': doc_type,
            'tax_type': tax_type,
            'region': '全国',
            'crawled_at': datetime.now(),
            'quality_score': 5,
            'crawl_source': 'manual',
        }

        # 删除同名旧数据
        self.collection.delete_many({'title': title})
        # 插入新数据
        self.collection.insert_one(policy_data)

        self.logger.info(f"保存: {title} ({len(content)} 字符)")
        return {
            'name': name,
            'title': title,
            'level': level,
            'content_length': len(content),
        }

    def crawl_all(self):
        """爬取所有法律"""
        self.logger.info("=" * 60)
        self.logger.info("开始导入法律文本")
        self.logger.info("=" * 60)

        # 导入法律
        laws_config = [
            ('增值税法', LAWS_TEXT['增值税法'], 'L1', '法律', ['增值税']),
            ('个人所得税法', LAWS_TEXT['个人所得税法'], 'L1', '法律', ['个人所得税']),
            ('企业所得税法', LAWS_TEXT['企业所得税法'], 'L1', '法律', ['企业所得税']),
            ('税收征收管理法', LAWS_TEXT['税收征收管理法'], 'L1', '法律', ['税收征管']),
        ]

        for name, content, level, doc_type, tax_type in laws_config:
            result = self.save_law(name, content, level, doc_type, tax_type)
            self.results.append(result)

        self.logger.info("\n" + "=" * 60)
        self.logger.info("导入完成!")
        self.logger.info("=" * 60)

    def print_results(self):
        """打印结果"""
        print(f"\n📊 导入结果:")
        print(f"成功: {len(self.results)} 条\n")

        for r in self.results:
            print(f"  • [{r['level']}] {r['name']}")
            print(f"    内容长度: {r['content_length']} 字符")


def main():
    """主函数"""
    crawler = LawsCrawlerFinal()
    crawler.crawl_all()
    crawler.print_results()


if __name__ == '__main__':
    main()
